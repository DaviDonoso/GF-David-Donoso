---
title: "Proyecto Gestión Financiera"
author: "David Donoso"
format: html
editor: visual
bibliography: references.bib
lang: es-CL
---

```{r configuraciones}
#| message: false
#| echo: false
# Esto ya debiera estar cargado en el proyecto en posit.cloud
#devtools::install_github("business-science/tidyquant")
#Loads tidyquant, lubridate, xts, quantmod, TTR, and PerformanceAnalytics
library(tidyverse)
library(tidyquant)  
```

# Hito 1:

## Descripción Activo y Contexto

Fecha de entrega límite: Miércoles 25 de Septiembre 23:59.

### Sector / Temática

Se definió el sector a trabajar de mercados de utilidades, específicamente de *Renewable* e *Independent Power Producers*. Principalmente, son compañías que se encargan de operar en el mercado de generación de energías y distribución de estas en el grado civil, industrial, retail y empresarial. A medida que el mundo transita hacia un futuro más sostenible, estas empresas desempeñan un rol crucial en la transición hacia fuentes de energía limpia, como la solar, eólica y nuclear. Dentro de este sector, el enfoque está en compañías que no solo generan energía renovable, sino que también son independientes en su capacidad de producir y distribuir energía sin depender de monopolios tradicionales de servicios públicos.

### Motivación

Se escogió este sector en particular, ya que en 2024 ha habido un creciente enfoque en la transición energética y las políticas globales que incentivan el uso de fuentes renovables. El presente año, el sector ha mostrado un crecimiento significativo impulsado por el aumento en la demanda de energías limpias, los incentivos políticos y la inversión en tecnología verde. Además, el sector de utilidades renovables ha sido un punto de interés para los inversores debido a su potencial de largo plazo y su relevancia para el entorno climático.

### Contexto

***Constellation Energy Corporation***, una empresa de energía estadounidense que se centra en la generación de electricidad a partir de fuentes limpias y renovables, como la energía nuclear, solar, eólica y gas natural. Es uno de los principales productores de energía limpia y fuentes de carácter sostenible de EEUU. Pertenece al sector de utilidades, proporcionando servicios esenciales a clientes individuales y empresariales, destacando su rol de generación y distribución de electricidad proveniente de fuentes renovables.

*Constellation Energy Corporation* se formó a partir del año 2022, luego de que una de las empresas más grandes de servicios públicos estadounidense Exelon Corporation se desligara de la generación de energía como parte de su negocio. Posee una capitalización de mercado de \$82,2B de dólares, dejándola en el primer puesto de empresas del sector de utilidades renovables. Su crecimiento ha sido impulsado por su capacidad de producir más de 32.000 MW de energía proveniente principalmente de fuentes que no emiten carbono.

***NRG Energy, Inc***. es una empresa de utilidades de venta y distribución de energía eléctrica. Se enfoca en llevar a cabo prácticas de energías más inteligentes, limpias y mejoradas digitalmente para sus clientes. Posee 7,5 millones de clientes en el mundo, 15.000 empleados, ha ganado el premio a “America's most responsible companies” de Newsweek en 2023. Su capitalización de mercado es de \$18,3B de dólares y es la segunda compañía más grande del sector utilidades I*ndependent Power Producers*.

La empresa ha sido un ejemplo en la reducción de emisiones con un objetivo de reducir su huella de carbono en un 50% para 2030.

***Vistra Corp*** es la empresa de Independent Power Producers más grande con una capitalización de mercado de \$40.7B. Con una estrategia diversificada entre generación de energía térmica y renovable, la empresa ha logrado mantener una posición sólida en el mercado, especialmente en periodos de transición energética. Su capacidad de integrar fuentes renovables con una infraestructura existente le ha permitido captar un amplio segmento del mercado de energía en EEUU.

*Vistra Corp* tiene una capacidad de generación instalada de más de 37.000 MW, principalmente de energía solar y eólica.

A continuación, se muestra un gráfico con los precios históricos de las empresas relacionadas desde el 2020 hasta el 2024 del presente dia:

```{r ETL}
#| echo: false
library(tidyquant)
library(dplyr)
library(ggplot2)
library(lubridate)

# Establecer la fecha final
end <- as_date("2024-09-25")

# Obtener precios de las acciones
constellation <- tq_get("CEG", get = "stock.prices", from = "2020-01-01", to = end)
nrg <- tq_get("NRG", get = "stock.prices", from = "2020-01-01", to = end)
vistra <- tq_get("VST", get = "stock.prices", from = "2020-01-01", to = end)

# Combinar los data frames
CL <- rbind(constellation, nrg, vistra)

# Gráfico de líneas
start <- end - weeks(6) # Establecer el rango de fechas para el gráfico

CL %>%
    filter(date >= start - days(30)) %>% # Filtrar datos de las últimas 6 semanas
    ggplot(aes(x = date, y = close, group = symbol)) +
    geom_line() +
    labs(title = "Precios de Acciones de Empresas del Sector Energético",
         subtitle = "Comparativo de Constellation Energy, NRG Energy y Vistra Corp.",
         y = "Precio al Cierre", x = "") +
    coord_x_date(xlim = c(start, end)) +
    facet_wrap(~ symbol, ncol = 2, scale = "free_y") +
    theme_tq()

```

Teniendo en cuenta los precios de cierre de cada una de las empresas, siendo para *Constellation Energy Corporation* de `r round(mean(CEG$close), digits=0)`, `r round(mean(NRG$close), digits=0)` para NRG y `r round(mean(VST$close), digits=0)` para *Vistro.* a

### Modelo Binomial

El Modelo Binomial de Valoración de Opciones (BM, por sus siglas en inglés) también conocido como Cox-Ross-Rubinstein introducido en @cox1979, es un modelo que estima el valor de una opción en t=0 teniendo pagos futuros en diferentes estados (usualmente "Up" y "Down"). Este Modelo Binomial asume que no hay posibilidad de arbitraje en el mercado, determinando el precio que sigue un activo en un random walk, en donde en cada paso (tiempo) existe una probabilidad de que el precio suba o baje (Ahmad, 2018).

![Random Walk en BM de un paso (Ahmad, 2018)](Data/Screenshot%202023-10-19%20at%2010.33.38.png){fig-align="center"}

Para calcular la valoración de la opción con el Modelo Binomial, es necesario definir $S_0$, que corresponde al precio actual del activo. Además, se deben determinar los valores de $u$ y $d$, que representan los factores por los cuales se multiplica $S_0$ en cada estado para obtener el precio del activo en cada caso en el siguiente período (t = 1):

$$
S_1 = \begin{cases}    S_0\cdot u \text{ en el estado ``Up"} \\    
S_0\cdot d \text{ en el estado ``Down"}\end{cases}
$$

También se debe calcular la probabilidad $P$ de que ocurra el caso "Up", la probabilidad de que ocurra el otro caso ("Down") simplemete quedaría en $(1-P)$. Para el calculo de la porobabilidad se usa la siguiente ecuación:

$$
P = \frac{e^r-d}{u-d}
$$

Donde $r$ es la tasa libre de riesgo.

Por otro lado se deben calcular $C_u$ y $C_d$ los cuales se obtienen como los precios de una opción europea:

$$
C_u = max(0, S_0\cdot u-k)\\
C_d = max(0, S_0\cdot d-k)
$$

Finalmente el precio de la opción se calcula de la siguiente manera:

$$
V = \frac{C_u\cdot P + C_d\cdot (1-P)}{1+r}
$$

```{r}
binomial_model <- function(cu, p, cd, rf) {
  return((cu*p + cd*(1-p))/(1+rf))
} 

S <- tail(ENELCHILE$close,1)  # Precio actual del activo subyacente
K <- 38  # Precio de ejercicio de la opción
T <- 1  # Tiempo hasta la expiración (en años)
r <- 0.0642 # Tasa de interés libre de riesgo
u <- 1.1  # Factor de crecimiento en un paso hacia arriba
d <- 0.9  # Factor de crecimiento en un paso hacia abajo

Su <- S*u
Sd <- S*d
p <- (1+r-d)/((1+r)*(u-d))

cu <- max(Su - K, 0)
cd <- max(Sd - K, 0)


print(paste("El precio de la opción con el Modelo Binomial es ", binomial_model(cu, p, cd, r)))

```

### Modelo Black and Scholes (BS)

```{r}
black_scholes <- function(S, K, t, r, sigma) {
    d1 <- (log(S/K) + (r + 0.5 * sigma^2) * t) / (sigma * sqrt(t))
    d2 <- d1 - sigma * sqrt(t)
    N_d1 <- pnorm(d1)
    N_d2 <- pnorm(d2)
    precio_call <- S * N_d1 - K * exp(-r * t) * N_d2
    return(precio_call)
  }
  
rendimientos <- diff(log(ENELCHILE$close))
sigma<-sd(rendimientos[2:length(rendimientos)])
volatilidad<-var(rendimientos[2:length(rendimientos)])


S<- tail(ENELCHILE$close,1) # Precio actual del activo subyacente
K<- 38 # Precio de ejercicio de la opción
R<- 0.0642 # Tasa de interés libre de riesgo
t <- 1 # Tiempo hasta la expiración (en años)

print(paste("El precio de la opción con el Modelo Black and Scholes es ", black_scholes(S, K, t, R, sigma)))


```

### Comparación de modelos

Ambos modelos son comúnmente utilizados en las finanzas. Por lo tanto, se puede afirmar que cuentan con respaldo y fundamentos sólidos. Según el artículo de (Ahmad, 2018), los resultados del precio de la opción calculados con ambos modelos muestran una correlación muy cercana a 1, lo que significa que si el precio de la opción aumenta con un modelo, también lo hace con el otro. Sin embargo, esto no implica que ambos modelos proporcionen el mismo precio, como se puede observar en el ejercicio realizado anteriormente.

Estos modelos difieren en algunas cosas, tales como:

-   Precio del activo subyacente: En modelo Black and Scholes sigue una distribución lognormal mientras que el Binomial multiplica el valos $S_0$ con dos opciones ($u$ y $d$)

-   Debido a lo anterior, el modelo de Black and Scholes es continuo y el Binomial discreto.

-   El modelo BS sirve solo para opciones europeas, mientras que el Binomial también sirve para opciones americanas.

También tienen algunas similitudes:

-   Ambos utilizan el precio actual del activo subyacente.

-   Ambos usan la tasa libre de riesgo.

-   En este caso los dos se usaron para un periodo de tiempo.

-   Ambos consideran la volatilidad del activo.

En resumen, el modelo de Black-Scholes constituye una buena herramienta analítica para valorar opciones europeas y supone movimientos continuos en las cotizaciones del mercado. En cambio, el modelo Binomial ofrece mayor flexibilidad al emplear una estructura de árbol que facilita la valoración tanto de opciones europeas como americanas. Elegir uno u otro modelo dependerá del tipo específico de opción que se esté analizando y las inferencias que se quieran hacer en relación a cómo evolucionarán los precios en el mercado financiero.

## Bibliografía

Ahmad Dar, A., Anuradha, N., 1 Department of Mathematics and Actuarial Science, B S Abdur Rahman Crescent University, IN, & 2 Department of Management Studies, B S Abdur Rahman Crescent University, IN. (2018). Comparison: Binomial model and Black Scholes model. *Quantitative Finance and Economics*, *2*(1), 230--245. <https://doi.org/10.3934/QFE.2018.1.230>
